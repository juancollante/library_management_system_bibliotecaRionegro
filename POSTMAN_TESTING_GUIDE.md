# üß™ Gu√≠a Completa para Probar APIs en Postman

## üìã Prerequisitos

### 1. Instalar Postman
- Descarga Postman desde: https://www.postman.com/downloads/
- Crea una cuenta gratuita (opcional pero recomendada)

### 2. Iniciar el servidor
```bash
cd backend
npm start
# Servidor debe correr en http://localhost:4000
```

---

## üîß Configuraci√≥n Inicial en Postman

### 1. Crear una nueva Collection
1. Abrir Postman
2. Click en "New" ‚Üí "Collection"
3. Nombrar: "Sistema Bibliotecario APIs"
4. Guardar

### 2. Configurar Variables de Entorno
1. Click en el √≠cono de engranaje (Settings)
2. "Manage Environments" ‚Üí "Add"
3. Nombre del ambiente: "Library API Local"
4. Agregar variables:
   - **Variable**: `baseURL`, **Value**: `http://localhost:4000/api`
   - **Variable**: `adminUserId`, **Value**: (se llenar√° despu√©s)
   - **Variable**: `studentUserId`, **Value**: (se llenar√° despu√©s)
   - **Variable**: `bookId`, **Value**: (se llenar√° despu√©s)
   - **Variable**: `transactionId`, **Value**: (se llenar√° despu√©s)

---

## üß™ Tests Paso a Paso

### PASO 1: Registro de Usuarios

#### Test 1.1: Registrar Administrador
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/auth/register`

**Headers**:
```
Content-Type: application/json
```

**Body** (raw JSON):
```json
{
  "userType": "Employee",
  "userFullName": "Admin Sistema",
  "employeeId": "EMP001",
  "age": 30,
  "dob": "1993-01-15",
  "gender": "Male",
  "address": "Calle Principal 123",
  "mobileNumber": 3001234567,
  "email": "admin@biblioteca.com",
  "password": "admin123",
  "isAdmin": true
}
```

**Tests** (pesta√±a Tests):
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("User created successfully", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('_id');
    pm.environment.set("adminUserId", jsonData._id);
});
```

#### Test 1.2: Registrar Estudiante
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/auth/register`

**Body** (raw JSON):
```json
{
  "userType": "Student",
  "userFullName": "Juan P√©rez",
  "admissionId": "STU001",
  "age": 22,
  "dob": "2001-05-20",
  "gender": "Male",
  "address": "Carrera 45 #23-67",
  "mobileNumber": 3007654321,
  "email": "juan.perez@estudiante.com",
  "password": "student123",
  "isAdmin": false
}
```

**Tests**:
```javascript
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Student created successfully", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('_id');
    pm.environment.set("studentUserId", jsonData._id);
});
```

---

### PASO 2: Autenticaci√≥n

#### Test 2.1: Login Admin
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/auth/signin`

**Body** (raw JSON):
```json
{
  "employeeId": "EMP001",
  "password": "admin123"
}
```

**Tests**:
```javascript
pm.test("Admin login successful", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.isAdmin).to.be.true;
});
```

#### Test 2.2: Login Estudiante
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/auth/signin`

**Body** (raw JSON):
```json
{
  "admissionId": "STU001",
  "password": "student123"
}
```

---

### PASO 3: Gesti√≥n de Categor√≠as

#### Test 3.1: Crear Categor√≠a
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/categories/addcategory`

**Body** (raw JSON):
```json
{
  "categoryName": "Ficci√≥n"
}
```

#### Test 3.2: Obtener Todas las Categor√≠as
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/categories/allcategories`

**Tests**:
```javascript
pm.test("Categories retrieved successfully", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.be.an('array');
    if (jsonData.length > 0) {
        pm.environment.set("categoryId", jsonData[0]._id);
    }
});
```

---

### PASO 4: Gesti√≥n de Libros

#### Test 4.1: Agregar Libro
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/books/addbook`

**Body** (raw JSON):
```json
{
  "isAdmin": true,
  "bookName": "Cien A√±os de Soledad",
  "alternateTitle": "",
  "author": "Gabriel Garc√≠a M√°rquez",
  "bookCountAvailable": 5,
  "language": "Espa√±ol",
  "publisher": "Editorial Sudamericana",
  "bookStatus": "Available",
  "categories": ["{{categoryId}}"]
}
```

**Tests**:
```javascript
pm.test("Book created successfully", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('_id');
    pm.environment.set("bookId", jsonData._id);
});
```

#### Test 4.2: Obtener Todos los Libros
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/books/allbooks`

#### Test 4.3: Obtener Libro por ID
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/books/getbook/{{bookId}}`

---

### PASO 5: B√∫squeda Avanzada (APIs Nuevas)

#### Test 5.1: B√∫squeda General
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/search/search?query=Cien&author=Garc√≠a`

**Tests**:
```javascript
pm.test("Search results returned", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('success', true);
    pm.expect(jsonData.data).to.be.an('array');
});
```

#### Test 5.2: Libros con Paginaci√≥n
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/search/paginated?page=1&limit=5`

#### Test 5.3: Libros Disponibles
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/search/available`

#### Test 5.4: Libros Populares
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/search/popular?limit=3`

#### Test 5.5: Libros Recientes
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/search/recent?limit=5&days=30`

---

### PASO 6: Estad√≠sticas (APIs Nuevas)

#### Test 6.1: Dashboard General
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/statistics/dashboard`

**Tests**:
```javascript
pm.test("Dashboard stats retrieved", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.success).to.be.true;
    pm.expect(jsonData.data).to.have.property('totalBooks');
    pm.expect(jsonData.data).to.have.property('totalUsers');
});
```

#### Test 6.2: Estad√≠sticas por Categor√≠a
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/statistics/books-by-category`

#### Test 6.3: Transacciones Mensuales
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/statistics/monthly-transactions?year=2023`

#### Test 6.4: Usuarios M√°s Activos
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/statistics/active-users?limit=5`

---

### PASO 7: Sistema de Reservas (APIs Nuevas)

#### Test 7.1: Crear Reserva
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/reservations/reserve`

**Body** (raw JSON):
```json
{
  "bookId": "{{bookId}}",
  "userId": "{{studentUserId}}",
  "reservationDate": "2023-10-05T10:30:00.000Z"
}
```

**Tests**:
```javascript
pm.test("Reservation created successfully", function () {
    pm.response.to.have.status(201);
    var jsonData = pm.response.json();
    pm.expect(jsonData.success).to.be.true;
    pm.environment.set("reservationId", jsonData.data._id);
});
```

#### Test 7.2: Obtener Todas las Reservas
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/reservations/all-reservations`

#### Test 7.3: Reservas de Usuario
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/reservations/user-reservations/{{studentUserId}}`

#### Test 7.4: Emitir Libro Reservado
**M√©todo**: `PUT`  
**URL**: `{{baseURL}}/reservations/issue-reserved/{{reservationId}}`

**Body** (raw JSON):
```json
{
  "isAdmin": true,
  "fromDate": "2023-10-05T10:30:00.000Z",
  "toDate": "2023-10-19T10:30:00.000Z"
}
```

---

### PASO 8: Transacciones

#### Test 8.1: Crear Transacci√≥n (Pr√©stamo)
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/transactions/add-transaction`

**Body** (raw JSON):
```json
{
  "isAdmin": true,
  "bookId": "{{bookId}}",
  "borrowerId": "{{studentUserId}}",
  "bookName": "Cien A√±os de Soledad",
  "borrowerName": "Juan P√©rez",
  "transactionType": "Issued",
  "fromDate": "2023-10-05T10:30:00.000Z",
  "toDate": "2023-10-19T10:30:00.000Z"
}
```

**Tests**:
```javascript
pm.test("Transaction created successfully", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.environment.set("transactionId", jsonData._id);
});
```

#### Test 8.2: Obtener Todas las Transacciones
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/transactions/all-transactions`

---

### PASO 9: Notificaciones (APIs Nuevas)

#### Test 9.1: Notificaciones de Admin
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/notifications/admin`

**Tests**:
```javascript
pm.test("Admin notifications retrieved", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.success).to.be.true;
    pm.expect(jsonData.data).to.be.an('array');
});
```

#### Test 9.2: Notificaciones de Usuario
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/notifications/user/{{studentUserId}}`

#### Test 9.3: Contador de Notificaciones
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/notifications/count/{{studentUserId}}`

#### Test 9.4: Enviar Recordatorios
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/notifications/send-reminders`

**Body** (raw JSON):
```json
{
  "isAdmin": true
}
```

---

### PASO 10: Gesti√≥n de Usuarios

#### Test 10.1: Obtener Todos los Usuarios
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/users/allmembers`

#### Test 10.2: Obtener Usuario por ID
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/users/getuser/{{studentUserId}}`

#### Test 10.3: Historial de Usuario (Nueva API)
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/statistics/user-history/{{studentUserId}}`

---

## üìä Tests de Validaci√≥n de Errores

### Test Error 1: Crear libro sin permisos de admin
**M√©todo**: `POST`  
**URL**: `{{baseURL}}/books/addbook`

**Body** (raw JSON):
```json
{
  "isAdmin": false,
  "bookName": "Libro Sin Permisos",
  "author": "Autor Test"
}
```

**Tests**:
```javascript
pm.test("Access denied for non-admin", function () {
    pm.response.to.have.status(403);
});
```

### Test Error 2: Buscar libro inexistente
**M√©todo**: `GET`  
**URL**: `{{baseURL}}/books/getbook/invalidid123`

**Tests**:
```javascript
pm.test("Invalid ID returns error", function () {
    pm.response.to.have.status(500);
});
```

---

## üîÑ Orden de Ejecuci√≥n Recomendado

1. **Usuarios**: Registro ‚Üí Login
2. **Categor√≠as**: Crear ‚Üí Listar
3. **Libros**: Crear ‚Üí Listar ‚Üí Buscar
4. **Reservas**: Crear ‚Üí Listar ‚Üí Convertir a pr√©stamo
5. **Transacciones**: Crear ‚Üí Listar
6. **Estad√≠sticas**: Dashboard ‚Üí Reportes
7. **Notificaciones**: Admin ‚Üí Usuario ‚Üí Recordatorios

---

## üí° Tips para Usar Postman

### 1. Variables Din√°micas
Usa `{{$timestamp}}` para fechas din√°micas
Usa `{{$randomEmail}}` para emails aleatorios

### 2. Scripts √ötiles
**Pre-request Script** (para generar datos):
```javascript
pm.environment.set("currentDate", new Date().toISOString());
```

**Test Script** (para validar respuestas):
```javascript
pm.test("Response is JSON", function () {
    pm.response.to.be.json;
});
```

### 3. Collection Runner
- Selecciona toda la collection
- Click "Run"
- Ejecuta todos los tests en secuencia

---

## üêõ Soluci√≥n de Problemas

### Problema: "ECONNREFUSED"
**Soluci√≥n**: Verifica que el servidor est√© corriendo en `http://localhost:4000`

### Problema: "User not found"
**Soluci√≥n**: Aseg√∫rate de ejecutar primero los tests de registro

### Problema: "Book not available"
**Soluci√≥n**: Verifica que el libro tenga `bookCountAvailable > 0`

---

## üìã Checklist Final

- [ ] Postman instalado
- [ ] Servidor corriendo (`npm start`)
- [ ] Environment configurado
- [ ] Variables de entorno creadas
- [ ] Collection creada
- [ ] Tests b√°sicos ejecutados
- [ ] Tests de error validados
- [ ] Documentaci√≥n revisada

¬°Con esta gu√≠a tienes tests completos para todas las 35+ APIs de tu sistema bibliotecario! üöÄ